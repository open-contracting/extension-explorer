sudo: false
language: python
cache: pip
python:
  - "3.6"
addons:
  chrome: stable
env:
  global:
  # GITHUB_ACCESS_TOKEN
  - secure: "Zgl2QEJfv1XzodvsKGEIociz5DdJtCzNsa/RWcqBljb+b0QKVlQhxTZlGunHMea0eCAsTakoINa6oeZr75ubo1s9mgcQHEmTUh3CNiJlwvk5NwKqzhwQKKr/FSihOKbI7rv/je19MGWpSMSHzcX5uzKAONoHD+HxpPRkleG1el8mp0hsDxNfjZK5BtSObWVNFxIgLLXmR+ZEIT5Oj+gS3qB8kUsTAHLo06/1js6Hct2gXGZQ5HC4Bru7q17GsHxpLBuONVKdGdRTQKl5n14h2uMIfm8agXwFF56ILgqISy7Us2ca7ulsHCrtBXdWvmbCFaNlve4qQzxkQOL018ScIjEGvxRkrfE5xZnIEWC52/d5+I08hL3qc613DDauIjStloFIhEfo9iYkGrM1GWXXcSCoO++EFcR71ZdQwsfnTLSD4DDP/QDWFA5q7fN22ImKtL3XMirAoLGaVwvQASDO69IttS1M8prbEaoFYkrsr5meSCztkwuZNPBuUq6K/lxpSgx8iNTIO9RAtTol7GPdhoKo9bt48OG+CeBlpVJRhNDluQqgZ/MhzkG85NvGUNuYZCJgYccWBu8PLZRRqyQm/83TkFowVNvm4NLYNUyl5Z2X36HHmzXSE6dUs+EHPS7ZyI5IlwhRWyMIcohBdMNvnYHizZsPN8gyHV8xNm34Ek0="
  matrix:
  - BASEDIR="https://raw.githubusercontent.com/open-contracting/standard-maintenance-scripts/master"
install:
  - curl -s -S --retry 3 $BASEDIR/tests/install.sh | bash -
  - pip install -r requirements.txt
script:
  - curl -s -S --retry 3 $BASEDIR/tests/script.sh | bash -
  - pytest --cov extension_explorer
after_success:
  - coveralls
  - |
    set -e
    git clone https://github.com/open-contracting/ocds-extensions-translations.git
    ocdsextensionregistry generate-data-file --locale-dir ocds-extensions-translations/locale > extension_explorer/data/extensions.json
    python freeze.py
deploy:
  provider: pages
  skip-cleanup: true
  github-token: "$GITHUB_ACCESS_TOKEN"
  local-dir: extension_explorer/build
  fqdn: extensions.open-contracting.org
